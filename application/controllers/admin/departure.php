<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Departure extends MY_Controller {    function __construct()    {        parent:: __construct();        if(!check_user()) {            redirect('admin/');        }    }    function index($offset = '')    {        if($offset == '') $offset = 0;        $admin = $this->common_model->get_all('tbl_departures', '', 'id DESC');        $this->load->library('pagination');        $config['base_url'] = base_url('admin/departure');        $config['total_rows'] = count($admin);        $config['uri_segment'] = '3';        $config['num_links'] = '5';        $config['per_page'] = 10;        $this->pagination->initialize($config);        $query = "SELECT                      d.`id`,                      t.name AS trip_name                    FROM                      tbl_departures d                      JOIN tbl_trips t                        ON t.`id` = d.`trip_id`                    ORDER BY id DESC                    LIMIT $offset, 10";        $data['admins'] = $this->db->query($query)->result_array();        $data['pagination'] = $this->pagination->create_links();        $data['main_content'] = 'admin/departure/index';        $data['sub_content'] = 'admin/departure/_departures';        $this->load->view(BACKEND, $data);    }    function add_update()    {        $id = segment(4);        if($_POST) {            $post = $_POST;            $departure_data = [                'trip_id' => $post['trip_id'],            ];            if($id == '') {                $id = $this->common_model->insert('tbl_departures', $departure_data, true);            }            $this->common_model->delete_data('tbl_departure_date', ['departure_id' => $id]);            foreach($post['date_from'] as $key => $date_from) {                if($date_from != '') {                    $departure_date_data = [                        'departure_id' => $id,                        'date_from' => $date_from,                        'date_to' => $post['date_to'][$key],                        'price' => $post['price'][$key],                        'type' => $post['type'][$key],                    ];                    $this->common_model->insert('tbl_departure_date', $departure_date_data);                }            }            set_flash('msg', 'Departure saved');            redirect('admin/departure');        } else {            $data = array(                'main_content' => 'admin/departure/index',                'sub_content' => 'admin/departure/_form',            );            if($id != '') {                $data['departure'] = $this->common_model->get_where('tbl_departures', array('id' => $id));            }            $this->load->view(BACKEND, $data);        }    }    function delete()    {        $this->common_model->delete_data('tbl_departures', array('id' => segment(4)));        set_flash('msg', 'Departure deleted');        redirect('admin/departure');    }}